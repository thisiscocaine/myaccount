<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="icon" type="image/x-icon" href="https://cdn.aryanaryal.com.np/626c6f672d617279616e/70686f746f73/6c6f676f73/favicon.png">
    <title>Terminal Blog</title>

    <!-- Marked.js for Markdown rendering -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Highlight.js for syntax highlighting -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/monokai-sublime.min.css">
    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/lib/highlight.min.js"></script>
    <!-- DOMPurify for sanitizing Markdown -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/2.4.1/purify.min.js"></script>

    <style>
    :root {
        --background: #000000;
        --text: #FFFFFF;
        --prompt: #00FF00;
        --accent: #FF0000;
        --header: #D3D3D3;
        --scrollbar: #555555;
        --scrollbar-track: #1A1A1A;
    }

    [data-theme="light"] {
        --background: #74001b;
        --text: #000000;
        --prompt: #008000;
        --accent: #FF0000;
        --header: #E0E0E0;
        --scrollbar: #888888;
        --scrollbar-track: #F0F0F0;
    }

    body {
        background: linear-gradient(135deg, #3b5998 0%, #8e44ad 100%);
        animation: appleGradient 15s ease infinite;
        color: var(--text);
        font-family: 'Menlo', 'SF Mono', 'Courier New', monospace;
        height: 100vh;
        margin: 0;
        padding: 15px;
        overflow: auto;
        position: relative;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        touch-action: manipulation; /* Optimize for touch */
    }

    @keyframes appleGradient {
        0% { background: linear-gradient(135deg, #1250d4 0%, #8517b4 100%); }
        33% { background: linear-gradient(135deg, #8517b4 0%, #ad1538 100%); }
        66% { background: linear-gradient(135deg, #ad1538 0%, #1250d4 100%); }
        100% { background: linear-gradient(135deg, #1250d4 0%, #8517b4 100%); }
    }

    ::selection {
        color: var(--background);
        background-color: var(--text);
    }

    .terminal {
        width: 80%;
        max-width: 900px;
        height: 500px;
        background: var(--background);
        border-radius: 6px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.5);
        overflow: hidden;
        display: flex;
        flex-direction: column;
        position: absolute;
        top: 50px;
        left: 50px;
        z-index: 1;
        touch-action: none;
        box-sizing: border-box;
        transition: transform 0.2s ease; /* Smooth scaling for touch feedback */
    }

    .terminal.minimized .terminal-body {
        display: none;
    }

    .terminal.maximized {
        width: calc(100% - 20px);
        height: calc(100% - 20px);
        max-width: none;
        top: 10px;
        left: 10px;
    }

    .terminal-header {
        background: var(--header);
        padding: 6px 12px;
        display: flex;
        align-items: center;
        border-bottom: 1px solid #B0B0B0;
        border-top-left-radius: 6px;
        border-top-right-radius: 6px;
        cursor: move;
        user-select: none;
    }

    .terminal-buttons {
        display: flex;
        gap: 6px;
    }

    .terminal-button {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        border: 1px solid rgba(0, 0, 0, 0.2);
        cursor: pointer;
        transition: transform 0.1s ease;
    }

    .terminal-button:active {
        transform: scale(0.9); /* Touch feedback */
    }

    .button-close { background: #FF5F56; }
    .button-minimize { background: #FFBD2E; }
    .button-maximize { background: #27C93F; }

    .terminal-title {
        margin: 0 auto;
        font-size: 0.9rem;
        color: #333333;
        font-weight: bold;
    }

    .terminal-body {
        flex: 1;
        padding: 15px;
        overflow-y: auto;
        color: var(--text);
        font-size: 0.9rem;
    }

    .prompt-line {
        display: flex;
        margin-bottom: 8px;
        align-items: center;
    }

    .prompt-user {
        color: var(--prompt);
        margin-right: 5px;
        font-weight: bold;
    }

    .prompt-input {
        background: transparent;
        border: none;
        color: var(--text);
        font-family: inherit;
        font-size: inherit;
        flex: 1;
        outline: none;
        caret-color: var(--accent);
    }

    .command-output {
    margin-bottom: 8px;
    line-height: 1.5;
    white-space: pre-wrap;
    overflow-wrap: anywhere;
    padding: 2px 4px;
    border-left: 2px solid transparent;
    text-align: left; /* Added to enforce left alignment */
}

    .command-output:hover {
        border-left-color: var(--prompt); /* Interactive feedback */
        background: rgba(255, 255, 255, 0.05); /* Subtle hover effect */
    }

    .terminal-body::-webkit-scrollbar {
        width: 8px;
    }

    .terminal-body::-webkit-scrollbar-track {
        background: var(--scrollbar-track);
    }

    .terminal-body::-webkit-scrollbar-thumb {
        background: var(--scrollbar);
        border-radius: 4px;
    }

    .hidden-input {
        opacity: 0;
        position: absolute;
        left: -9999px;
        width: 100%;
        height: 1.2em;
        caret-color: var(--accent);
        background: transparent;
        border: none;
        color: transparent;
        resize: none;
        font: inherit;
        padding: 0;
        margin: 0;
        overflow: hidden;
    }

    .cursor {
        display: inline-block;
        width: 2px;
        height: 1em;
        background: var(--accent);
        animation: blink 1s step-end infinite;
        vertical-align: middle;
    }

    @keyframes blink {
        50% { opacity: 0; }
    }

    .typer {
        display: inline-block;
        min-width: 10%;
        pointer-events: none;
    }

    .liner {
        margin-bottom: 10px;
        position: relative;
        display: flex;
        align-items: center;
    }

    b {
        font-weight: bold;
        text-decoration: underline;
        color: var(--text);
    }

    .liner.password::before {
        content: "Password: ";
        color: var(--accent);
    }

    p {
        display: block;
        margin: 0;
        overflow: hidden;
        white-space: pre-wrap;
        animation: typing 0.5s steps(30, end);
    }

    .no-animation {
        animation: none;
    }

    .margin {
        margin-left: 20px;
    }

    .index { color: #00FF00; }
    .color2 { color: #00FFFF; }
    .command { color: #00FFFF; }
    .error { color: var(--accent); }
    .white { color: var(--text); }
    .inherit, a { color: #87CEEB; }
    a { text-decoration: none; }
    a:hover { background: var(--accent); color: var(--background); }
    a:focus { outline: 0; }

    .banner-logo {
        display: block;
        margin: 0 auto 15px auto;
        width: 100px;
        height: auto;
    }

    .resize-handle {
        position: absolute;
        bottom: 0;
        right: 0;
        width: 12px;
        height: 12px;
        background: var(--scrollbar);
        cursor: nwse-resize;
        z-index: 10;
        transition: background 0.2s ease;
    }

    .resize-handle:hover {
        background: var(--prompt); /* Visual feedback */
    }

    .terminal.maximized .resize-handle {
        display: none;
    }

    /* Ultra-wide screens (8K+) */
    @media (min-width: 7680px) {
        body { padding: 30px; }
        .terminal {
            max-width: 2000px;
            height: 1000px;
            font-size: 1.5rem;
            border-radius: 10px;
        }
        .terminal-header { padding: 15px 25px; }
        .terminal-title { font-size: 1.4rem; }
        .terminal-button { width: 18px; height: 18px; }
        .terminal-body { padding: 30px; }
        .prompt-user, .prompt-input, p { font-size: 1.5rem; }
        .hidden-input { height: 1.8em; }
        .banner-logo { width: 200px; }
        .command-output { line-height: 1.7; padding: 4px 8px; }
        .resize-handle { width: 20px; height: 20px; }
        .terminal-body::-webkit-scrollbar { width: 12px; }
    }

    /* 4K screens */
    @media (min-width: 3840px) and (max-width: 7679px) {
        body { padding: 20px; }
        .terminal {
            max-width: 1400px;
            height: 800px;
            font-size: 1.3rem;
            border-radius: 8px;
        }
        .terminal-header { padding: 12px 20px; }
        .terminal-title { font-size: 1.2rem; }
        .terminal-button { width: 16px; height: 16px; }
        .terminal-body { padding: 25px; }
        .prompt-user, .prompt-input, p { font-size: 1.3rem; }
        .hidden-input { height: 1.6em; }
        .banner-logo { width: 180px; }
        .command-output { line-height: 1.6; padding: 3px 6px; }
        .resize-handle { width: 18px; height: 18px; }
        .terminal-body::-webkit-scrollbar { width: 10px; }
    }

    /* High-resolution desktops (2K) */
    @media (min-width: 2560px) and (max-width: 3839px) {
        body { padding: 15px; }
        .terminal {
            width: 85%;
            max-width: 1200px;
            height: 700px;
            font-size: 1.1rem;
        }
        .terminal-header { padding: 8px 16px; }
        .terminal-title { font-size: 1rem; }
        .terminal-button { width: 14px; height: 14px; }
        .terminal-body { padding: 20px; }
        .prompt-user, .prompt-input, p { font-size: 1.1rem; }
        .hidden-input { height: 1.4em; }
        .banner-logo { width: 140px; }
        .command-output { line-height: 1.5; padding: 3px 6px; }
        .resize-handle { width: 14px; height: 14px; }
    }

    /* Laptops (1080p to 1440p) */
    @media (min-width: 1440px) and (max-width: 2559px) {
        body { padding: 12px; }
        .terminal {
            width: 90%;
            height: 80vh;
            min-height: 500px;
            font-size: 1rem;
        }
        .terminal-header { padding: 6px 12px; }
        .terminal-title { font-size: 0.9rem; }
        .terminal-button { width: 12px; height: 12px; }
        .terminal-body { padding: 15px; }
        .prompt-user, .prompt-input, p { font-size: 1rem; }
        .hidden-input { height: 1.2em; }
        .banner-logo { width: 120px; }
        .command-output { line-height: 1.4; padding: 2px 4px; }
        .resize-handle { width: 12px; height: 12px; }
    }

    /* Tablets (landscape) */
    @media (min-width: 1024px) and (max-width: 1439px) {
        body { padding: 10px; }
        .terminal {
            width: 95%;
            height: 85vh;
            min-height: 450px;
            font-size: 0.95rem;
        }
        .terminal-header { padding: 5px 10px; }
        .terminal-title { font-size: 0.85rem; }
        .terminal-button { width: 11px; height: 11px; }
        .terminal-body { padding: 12px; }
        .prompt-user, .prompt-input, p { font-size: 0.95rem; }
        .hidden-input { height: 1.1em; }
        .banner-logo { width: 100px; }
        .command-output { line-height: 1.4; padding: 2px 4px; }
        .resize-handle { width: 10px; height: 10px; }
        .terminal-body::-webkit-scrollbar { width: 6px; }
        .terminal-body::-webkit-scrollbar-thumb { border-radius: 3px; }
    }

    /* Tablets (portrait) and smaller laptops */
    @media (min-width: 768px) and (max-width: 1023px) {
        body { padding: 8px; }
        .terminal {
            width: 98%;
            max-width: 100%;
            height: 80vh;
            min-height: 400px;
            font-size: 0.9rem;
        }
        .terminal.maximized {
            width: calc(100% - 16px);
            height: calc(100% - 16px);
            top: 8px;
            left: 8px;
        }
        .terminal-header { padding: 4px 8px; }
        .terminal-title { font-size: 0.8rem; }
        .terminal-button { width: 10px; height: 10px; }
        .terminal-body { padding: 10px; }
        .prompt-user, .prompt-input, p { font-size: 0.9rem; }
        .hidden-input { height: 1em; }
        .banner-logo { width: 90px; }
        .command-output { line-height: 1.3; padding: 2px 4px; }
        .resize-handle { width: 10px; height: 10px; }
    }

    /* Mobile devices (landscape) */
    @media (min-width: 600px) and (max-width: 767px) {
        body { padding: 6px; }
        .terminal {
            width: 100%;
            height: 85vh;
            min-height: 350px;
            border-radius: 4px;
            font-size: 0.85rem;
        }
        .terminal.maximized {
            width: calc(100% - 12px);
            height: calc(100% - 12px);
            top: 6px;
            left: 6px;
        }
        .terminal-header { padding: 4px 8px; }
        .terminal-title { font-size: 0.75rem; }
        .terminal-button { width: 9px; height: 9px; }
        .terminal-body { padding: 8px; }
        .prompt-user, .prompt-input, p { font-size: 0.85rem; }
        .hidden-input { height: 0.9em; }
        .banner-logo { width: 80px; }
        .command-output {
            line-height: 1.25;
            white-space: normal;
            overflow-wrap: anywhere;
            padding: 2px 4px;
        }
        .margin { margin-left: 10px; }
        .terminal-body::-webkit-scrollbar { width: 5px; }
        .resize-handle { width: 8px; height: 8px; }
        a:hover { background: transparent; text-decoration: underline; }
    }

    /* Mobile devices (portrait) */
    @media (min-width: 480px) and (max-width: 599px) {
        body { padding: 5px; align-items: flex-start; }
        .terminal {
            width: 100%;
            height: 90vh;
            min-height: 300px;
            border-radius: 4px;
            font-size: 0.8rem;
        }
        .terminal.maximized {
            width: calc(100% - 10px);
            height: calc(100% - 10px);
            top: 5px;
            left: 5px;
        }
        .terminal-header { padding: 3px 6px; }
        .terminal-title { font-size: 0.7rem; }
        .terminal-button { width: 8px; height: 8px; }
        .terminal-body { padding: 6px; }
        .prompt-user, .prompt-input, p { font-size: 0.8rem; }
        .hidden-input { height: 0.8em; }
        .banner-logo { width: 70px; }
        .command-output {
            line-height: 1.2;
            white-space: normal;
            overflow-wrap: anywhere;
            padding: 2px 4px;
        }
        .margin { margin-left: 8px; }
        .terminal-body::-webkit-scrollbar { width: 5px; }
        .terminal-body::-webkit-scrollbar-thumb { border-radius: 2px; }
        .resize-handle { width: 8px; height: 8px; }
    }

    /* Small mobile devices */
    @media (min-width: 360px) and (max-width: 479px) {
        body { padding: 4px; }
        .terminal {
            width: 100%;
            height: 92vh;
            min-height: 280px;
            border-radius: 3px;
            font-size: 0.75rem;
        }
        .terminal.maximized {
            width: calc(100% - 8px);
            height: calc(100% - 8px);
            top: 4px;
            left: 4px;
        }
        .terminal-header { padding: 3px 6px; }
        .terminal-title { font-size: 0.65rem; }
        .terminal-button { width: 7px; height: 7px; }
        .terminal-body { padding: 6px; }
        .prompt-user, .prompt-input, p { font-size: 0.75rem; }
        .hidden-input { height: 0.75em; }
        .banner-logo { width: 60px; }
        .command-output {
            line-height: 1.15;
            white-space: normal;
            overflow-wrap: anywhere;
            padding: 1px 3px;
        }
        .margin { margin-left: 6px; }
        .terminal-body::-webkit-scrollbar { width: 4px; }
        .resize-handle { width: 7px; height: 7px; }
    }

    /* Very small mobile devices */
    @media (min-width: 320px) and (max-width: 359px) {
        body { padding: 3px; }
        .terminal {
            width: 100%;
            height: 95vh;
            min-height: 260px;
            border-radius: 3px;
            font-size: 0.7rem;
        }
        .terminal.maximized {
            width: calc(100% - 6px);
            height: calc(100% - 6px);
            top: 3px;
            left: 3px;
        }
        .terminal-header { padding: 2px 5px; }
        .terminal-title { font-size: 0.6rem; }
        .terminal-button { width: 6px; height: 6px; }
        .terminal-body { padding: 5px; }
        .prompt-user, .prompt-input, p { font-size: 0.7rem; }
        .hidden-input { height: 0.7em; }
        .banner-logo { width: 50px; }
        .command-output {
            line-height: 1.1;
            white-space: normal;
            overflow-wrap: anywhere;
            padding: 1px 3px;
        }
        .margin { margin-left: 5px; }
        .terminal-body::-webkit-scrollbar { width: 4px; }
        .terminal-body::-webkit-scrollbar-thumb { border-radius: 2px; }
        .resize-handle { width: 6px; height: 6px; }
    }

    /* Extra-micro screens (e.g., smartwatches, foldable devices) */
    @media (min-width: 280px) and (max-width: 319px) {
        body { padding: 2px; }
        .terminal {
            width: 100%;
            height: 96vh;
            min-height: 240px;
            border-radius: 2px;
            font-size: 0.65rem;
        }
        .terminal.maximized {
            width: calc(100% - 4px);
            height: calc(100% - 4px);
            top: 2px;
            left: 2px;
        }
        .terminal-header { padding: 2px 4px; }
        .terminal-title { font-size: 0.55rem; }
        .terminal-button { width: 5px; height: 5px; }
        .terminal-body { padding: 4px; }
        .prompt-user, .prompt-input, p { font-size: 0.65rem; }
        .hidden-input { height: 0.65em; }
        .banner-logo { width: 45px; }
        .command-output {
            line-height: 1.05;
            white-space: normal;
            overflow-wrap: anywhere;
            padding: 1px 2px;
        }
        .margin { margin-left: 4px; }
        .terminal-body::-webkit-scrollbar { width: 3px; }
        .resize-handle { width: 5px; height: 5px; }
    }

    /* Ultra-micro screens (e.g., very small wearables) */
    @media (min-width: 240px) and (max-width: 279px) {
        body { padding: 1px; }
        .terminal {
            width: 100%;
            height: 97vh;
            min-height: 220px;
            border-radius: 2px;
            font-size: 0.6rem;
        }
        .terminal.maximized {
            width: calc(100% - 2px);
            height: calc(100% - 2px);
            top: 1px;
            left: 1px;
        }
        .terminal-header { padding: 1px 3px; }
        .terminal-title { font-size: 0.5rem; }
        .terminal-button { width: 4px; height: 4px; }
        .terminal-body { padding: 3px; }
        .prompt-user, .prompt-input, p { font-size: 0.6rem; }
        .hidden-input { height: 0.6em; }
        .banner-logo { width: 40px; }
        .command-output {
            line-height: 1;
            white-space: normal;
            overflow-wrap: anywhere;
            padding: 1px 2px;
        }
        .margin { margin-left: 3px; }
        .terminal-body::-webkit-scrollbar { width: 3px; }
        .terminal-body::-webkit-scrollbar-thumb { border-radius: 1px; }
        .resize-handle { width: 4px; height: 4px; }
    }

    /* Extreme-micro screens (e.g., experimental devices) */
    @media (min-width: 200px) and (max-width: 239px) {
        body { padding: 1px; }
        .terminal {
            width: 100%;
            height: 98vh;
            min-height: 200px;
            border-radius: 1px;
            font-size: 0.55rem;
        }
        .terminal.maximized {
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
        }
        .terminal-header { padding: 1px 2px; }
        .terminal-title { font-size: 0.45rem; }
        .terminal-button { width: 3px; height: 3px; }
        .terminal-body { padding: 2px; }
        .prompt-user, .prompt-input, p { font-size: 0.55rem; }
        .hidden-input { height: 0.55em; }
        .banner-logo { width: 35px; }
        .command-output {
            line-height: 1;
            white-space: normal;
            overflow-wrap: anywhere;
            padding: 0.5px 1px;
        }
        .margin { margin-left: 2px; }
        .terminal-body::-webkit-scrollbar { width: 2px; }
        .terminal-body::-webkit-scrollbar-thumb { border-radius: 1px; }
        .resize-handle { width: 3px; height: 3px; }
        .cursor { width: 1px; height: 0.8em; }
    }

    /* Super-extreme-micro screens (e.g., niche wearables) */
    @media (max-width: 199px) {
        body { padding: 0; }
        .terminal {
            width: 100%;
            height: 100vh;
            min-height: 180px;
            border-radius: 0;
            font-size: 0.5rem;
        }
        .terminal.maximized {
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
        }
        .terminal-header { padding: 0.5px 1px; }
        .terminal-title { font-size: 0.4rem; }
        .terminal-button { width: 2px; height: 2px; }
        .terminal-body { padding: 1px; }
        .prompt-user, .prompt-input, p { font-size: 0.5rem; }
        .hidden-input { height: 0.5em; }
        .banner-logo { width: 30px; }
        .command-output {
            line-height: 0.95;
            white-space: normal;
            overflow-wrap: anywhere;
            padding: 0.5px 1px;
        }
        .margin { margin-left: 1px; }
        .terminal-body::-webkit-scrollbar { width: 1px; }
        .terminal-body::-webkit-scrollbar-thumb { border-radius: 0.5px; }
        .resize-handle { width: 2px; height: 2px; }
        .cursor { width: 1px; height: 0.7em; }
        .terminal-buttons { gap: 2px; }
    }
</style>
</head>
<body data-theme="dark">
    <script>
        const terminals = new Map();

        const highlightScript = document.querySelector('script[src*="highlight.min.js"]');
        highlightScript.onload = () => {
            if (window.hljs) {
                hljs.highlightAll();
            } else {
                console.warn('Highlight.js failed to load.');
                if (terminals.size > 0) {
                    terminals.forEach(t => t.addLine('Warning: Syntax highlighting unavailable.', 'error margin', 0));
                }
            }
        };
        highlightScript.onerror = () => {
            console.warn('Highlight.js failed to load.');
            if (terminals.size > 0) {
                terminals.forEach(t => t.addLine('Error: Syntax highlighting failed to load.', 'error margin', 0));
            }
        };

        let blogPosts = {
            'terminal-info': {
                title: 'Terminal Info',
                content: '# Terminal Info\n\n**Font:** Menlo, monospace\n**Base Size:** 13px\nThis terminal uses the Menlo font, macOS default, with a base size of 13px, scaling responsively across devices.'
            },
            'welcome-to-my-blog': {
                title: 'Welcome to My Blog',
                content: '# Welcome to My Blog\n\nThis is the introductory post for the terminal blog.'
            },
            'second-post': {
                title: 'Second Post',
                content: '# Second Post\n\nThis is the second blog post.'
            },
            'ipadder': {
                title: 'ipadder',
                content: '# ipadder\n\nThis is the ipadder post.'
            },
            'test': {
                title: 'test',
                content: '# test\n\nThis is a test post.'
            },

	'hello': {
                title: 'hello',
                content: '# test\n\nThis is a test post.'
            }
        };

        async function loadBlogPosts() {
            const paths = ['./posts.json', 'https://raw.githubusercontent.com/thisiscocaine/6c616e64696e6770616765/main/posts.json'];
            for (const path of paths) {
                try {
                    const response = await fetch(path, {
                        headers: { 'Accept': 'application/json' },
                        cache: 'no-store'
                    });
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status} ${response.statusText}`);
                    }
                    const posts = await response.json();
                    blogPosts = Object.assign(blogPosts, posts);
                    terminals.forEach(t => t.addLine(`Blog posts loaded successfully from ${path}.`, 'white margin', 0));
                    return true;
                } catch (error) {
                    console.error(`Failed to load posts.json from ${path}: ${error.message}`);
                    terminals.forEach(t => t.addLine(`Warning: Failed to load posts.json from ${path}: ${error.message}. Using default posts.`, 'error margin', 0));
                }
            }
            terminals.forEach(t => t.addLine('Warning: Unable to load posts.json. Using default posts. Check browser console (F12) for details.', 'error margin', 0));
            return false;
        }

        let terminalCount = 0;

        const banner = [
            '<img src="https://cdn.aryanaryal.com.np/626c6f672d617279616e/70686f746f73/6c6f676f73/123852.png" alt="Logo" class="banner-logo">',
            `<span class="index">Terminal Blog © ${new Date().getFullYear()}</span>`,
            '<span class="color2">Welcome to the interactive web terminal blog.</span>',
            '<span class="color2">Type</span> <span class="command">blog</span> <span class="color2">to list posts, or enter a post title (e.g., <span class="command">Terminal Info</span>) to view a post.</span>',
            '<span class="color2">Type</span> <span class="command">help</span> <span class="color2">for available commands.</span>'
        ];

        class Terminal {
            constructor(id) {
                this.id = id;
                this.element = document.createElement('div');
                this.element.className = 'terminal';
                this.element.id = `terminal-${id}`;
                this.element.style.left = `${Math.min(1 + id * 2, window.innerWidth - 100)}vw`;
                this.element.style.top = `${Math.min(1 + id * 2, window.innerHeight - 100)}vw`;
                this.element.style.zIndex = 1000 + id;
                this.element.setAttribute('role', 'application');
                this.element.setAttribute('aria-label', 'Terminal Blog Emulator');

                this.element.innerHTML = `
                    <div class="terminal-header">
                        <div class="terminal-buttons">
                            <div class="terminal-button button-close" role="button" aria-label="Close terminal" tabindex="0"></div>
                            <div class="terminal-button button-minimize" role="button" aria-label="Minimize terminal" tabindex="0"></div>
                            <div class="terminal-button button-maximize" role="button" aria-label="Maximize terminal" tabindex="0"></div>
                        </div>
                        <div class="terminal-title">blog@terminal:~$</div>
                    </div>
                    <div class="terminal-body" role="log" aria-live="polite">
                        <div class="before"></div>
                        <div class="liner">
                            <span class="prompt-user">blog@terminal:~$ </span>
                            <span class="cursor" aria-hidden="true"></span>
                            <span class="prompt-input typer" aria-hidden="true"></span>
                            <textarea class="hidden-input texter" aria-label="Command input" spellcheck="false"></textarea>
                        </div>
                    </div>
                    <div class="resize-handle" role="button" aria-label="Resize terminal" tabindex="0"></div>
                `;

                this.before = this.element.querySelector('.before');
                this.liner = this.element.querySelector('.liner');
                this.command = this.element.querySelector('.typer');
                this.textarea = this.element.querySelector('.texter');
                this.terminalBody = this.element.querySelector('.terminal-body');
                this.cursorElement = this.element.querySelector('.cursor');
                this.commands = JSON.parse(localStorage.getItem(`terminal-${this.id}-history`)) || [];
                this.commandHistoryIndex = this.commands.length;
                this.isMinimized = false;
                this.isMaximized = false;

                document.body.appendChild(this.element);
                this.setup();
                this.loopLines(banner, "", 80);
                this.textarea.focus();
            }

            setup() {
                const header = this.element.querySelector('.terminal-header');
                let isDragging = false;
                let currentX, currentY;

                header.addEventListener('mousedown', (e) => {
                    e.preventDefault();
                    if (this.isMaximized) return;
                    isDragging = true;
                    currentX = e.clientX - parseInt(this.element.style.left || '0');
                    currentY = e.clientY - parseInt(this.element.style.top || '0');
                    this.bringToFront();
                });

                document.addEventListener('mousemove', (e) => {
                    if (isDragging) {
                        let newX = e.clientX - currentX;
                        let newY = e.clientY - currentY;
                        const maxX = window.innerWidth - this.element.offsetWidth - 10;
                        const maxY = window.innerHeight - this.element.offsetHeight - 10;
                        newX = Math.max(10, Math.min(newX, maxX));
                        newY = Math.max(10, Math.min(newY, maxY));
                        this.element.style.left = `${newX}px`;
                        this.element.style.top = `${newY}px`;
                    }
                });

                document.addEventListener('mouseup', () => {
                    isDragging = false;
                });

                header.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    if (this.isMaximized) return;
                    isDragging = true;
                    const touch = e.touches[0];
                    currentX = touch.clientX - parseInt(this.element.style.left || '0');
                    currentY = touch.clientY - parseInt(this.element.style.top || '0');
                    this.bringToFront();
                });

                document.addEventListener('touchmove', (e) => {
                    if (isDragging) {
                        const touch = e.touches[0];
                        let newX = touch.clientX - currentX;
                        let newY = touch.clientY - currentY;
                        const maxX = window.innerWidth - this.element.offsetWidth - 10;
                        const maxY = window.innerHeight - this.element.offsetHeight - 10;
                        newX = Math.max(10, Math.min(newX, maxX));
                        newY = Math.max(10, Math.min(newY, maxY));
                        this.element.style.left = `${newX}px`;
                        this.element.style.top = `${newY}px`;
                    }
                });

                document.addEventListener('touchend', () => {
                    isDragging = false;
                });

                this.element.addEventListener('mousedown', () => this.bringToFront());
                this.element.addEventListener('touchstart', () => this.bringToFront());

                this.element.querySelector('.button-close').addEventListener('click', () => this.close());
                this.element.querySelector('.button-minimize').addEventListener('click', () => {
                    this.isMinimized = !this.isMinimized;
                    this.element.classList.toggle('minimized', this.isMinimized);
                    if (!this.isMinimized) {
                        this.textarea.focus();
                        this.element.style.display = 'flex';
                    }
                });
                this.element.querySelector('.button-maximize').addEventListener('click', () => {
                    this.isMaximized = !this.isMaximized;
                    this.element.classList.toggle('maximized', this.isMaximized);
                    if (!this.isMaximized) {
                        this.element.style.left = `${Math.min(1 + this.id * 2, window.innerWidth - 100)}vw`;
                        this.element.style.top = `${Math.min(1 + this.id * 2, window.innerHeight - 100)}vw`;
                        this.element.style.width = '';
                        this.element.style.height = '';
                    }
                    this.element.style.display = 'flex';
                    this.textarea.focus();
                });

                const buttons = this.element.querySelectorAll('.terminal-button, .resize-handle');
                buttons.forEach(button => {
                    button.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            button.click();
                        }
                    });
                });

                const resizeHandle = this.element.querySelector('.resize-handle');
                let isResizing = false;
                let startX, startY, startWidth, startHeight;

                resizeHandle.addEventListener('mousedown', (e) => {
                    e.preventDefault();
                    if (this.isMaximized) return;
                    isResizing = true;
                    startX = e.clientX;
                    startY = e.clientY;
                    startWidth = this.element.offsetWidth;
                    startHeight = this.element.offsetHeight;
                    this.element.style.transition = 'none';
                    this.bringToFront();
                });

                document.addEventListener('mousemove', (e) => {
                    if (isResizing) {
                        const newWidth = startWidth + (e.clientX - startX);
                        const newHeight = startHeight + (e.clientY - startY);
                        const minWidth = 150;
                        const minHeight = 100;
                        const maxWidth = window.innerWidth - parseInt(this.element.style.left || '0') - 10;
                        const maxHeight = window.innerHeight - parseInt(this.element.style.top || '0') - 10;

                        this.element.style.width = `${Math.max(minWidth, Math.min(newWidth, maxWidth))}px`;
                        this.element.style.height = `${Math.max(minHeight, Math.min(newHeight, maxHeight))}px`;
                        this.element.style.display = 'flex';
                    }
                });

                document.addEventListener('mouseup', () => {
                    if (isResizing) {
                        this.element.style.transition = 'all 0.3s ease';
                    }
                    isResizing = false;
                });

                resizeHandle.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    if (this.isMaximized) return;
                    isResizing = true;
                    const touch = e.touches[0];
                    startX = touch.clientX;
                    startY = touch.clientY;
                    startWidth = this.element.offsetWidth;
                    startHeight = this.element.offsetHeight;
                    this.element.style.transition = 'none';
                    this.bringToFront();
                });

                document.addEventListener('touchmove', (e) => {
                    if (isResizing) {
                        const touch = e.touches[0];
                        const newWidth = startWidth + (touch.clientX - startX);
                        const newHeight = startHeight + (touch.clientY - startY);
                        const minWidth = 150;
                        const minHeight = 100;
                        const maxWidth = window.innerWidth - parseInt(this.element.style.left || '0') - 10;
                        const maxHeight = window.innerHeight - parseInt(this.element.style.top || '0') - 10;

                        this.element.style.width = `${Math.max(minWidth, Math.min(newWidth, maxWidth))}px`;
                        this.element.style.height = `${Math.max(minHeight, Math.min(newHeight, maxHeight))}px`;
                        this.element.style.display = 'flex';
                    }
                });

                document.addEventListener('touchend', () => {
                    if (isResizing) {
                        this.element.style.transition = 'all 0.3s ease';
                    }
                    isResizing = false;
                });

                this.textarea.addEventListener('input', () => {
                    this.command.textContent = this.textarea.value;
                    this.cursorElement.style.visibility = this.textarea.value.length > 0 ? 'hidden' : 'visible';
                });

                this.textarea.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        const commandText = this.textarea.value;
                        if (commandText) {
                            this.commands.push(commandText);
                            localStorage.setItem(`terminal-${this.id}-history`, JSON.stringify(this.commands));
                            this.commandHistoryIndex = this.commands.length;
                            this.addLine(`blog@terminal:~$ ${commandText}`, "no-animation", 0);
                            this.executeCommand(commandText);
                            this.command.textContent = "";
                            this.textarea.value = "";
                            this.cursorElement.style.visibility = 'visible';
                        }
                    } else if (e.key === 'ArrowUp' && this.commandHistoryIndex > 0) {
                        e.preventDefault();
                        this.commandHistoryIndex--;
                        this.textarea.value = this.commands[this.commandHistoryIndex] || "";
                        this.command.textContent = this.textarea.value;
                        this.cursorElement.style.visibility = this.textarea.value.length > 0 ? 'hidden' : 'visible';
                    } else if (e.key === 'ArrowDown' && this.commandHistoryIndex < this.commands.length) {
                        e.preventDefault();
                        this.commandHistoryIndex++;
                        if (this.commandHistoryIndex === this.commands.length) {
                            this.textarea.value = "";
                            this.command.textContent = "";
                        } else {
                            this.textarea.value = this.commands[this.commandHistoryIndex];
                            this.command.textContent = this.textarea.value;
                        }
                        this.cursorElement.style.visibility = this.textarea.value.length > 0 ? 'hidden' : 'visible';
                    }
                    this.terminalBody.scrollTop = this.terminalBody.scrollHeight;
                });

                this.terminalBody.addEventListener('click', () => this.textarea.focus());
            }

            bringToFront() {
                const maxZ = Math.max(...Array.from(document.querySelectorAll('.terminal')).map(t => parseInt(t.style.zIndex || '1000')));
                this.element.style.zIndex = maxZ + 1;
            }

            close() {
                terminals.delete(this.id);
                this.element.remove();
                if (terminals.size === 0) {
                    new Terminal(terminalCount++);
                }
            }

            addLine(text, style, time) {
                let t = "";
                for (let i = 0; i < text.length; i++) {
                    if (text.charAt(i) === " " && text.charAt(i + 1) === " ") {
                        t += "  ";
                    } else {
                        t += text.charAt(i);
                    }
                }
                setTimeout(() => {
                    const next = document.createElement("p");
                    next.innerHTML = t;
                    next.className = `command-output ${style}`;
                    this.before.parentNode.insertBefore(next, this.before);
                    this.terminalBody.scrollTo({
                        top: this.terminalBody.scrollHeight,
                        behavior: 'smooth'
                    });
                }, time);
            }

            loopLines(lines, style, time) {
                let delay = 0;
                lines.forEach((item) => {
                    this.addLine(item, style, delay);
                    delay += time;
                });
            }

            async executeCommand(cmd) {
                const parts = cmd.trim().split(' ');
                const command = parts[0].toLowerCase();
                const args = parts.slice(1).join(' ');

                // Dynamic column widths based on screen size
                const isMicroScreen = window.innerWidth <= 359;
                const idPad = isMicroScreen ? 4 : 5;
                const titlePad = isMicroScreen ? 20 : 30;
                const slugPad = isMicroScreen ? 20 : 30;
                const helpCmdPad = isMicroScreen ? 15 : 21;

                if (command === "help") {
                    const helpText = [
                        '<span class="white">Available Commands:</span>',
                        '<span class="white">------------------</span>',
                        `<span class="command">prompt${' '.repeat(idPad)}</span><span class="white"> -Enter a command.</span>`,
                        `<span class="command">blog${' '.repeat(idPad)}</span><span class="white">-List all blog posts.</span>`,
                        `<span class="command">theme${' '.repeat(idPad)}</span><span class="white">-Toggle light/dark theme.</span>`
                    ];
                    this.loopLines(helpText, "white margin", 80);
                    return;
                }

                if (command === "theme") {
                    const newTheme = document.body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
                    document.body.setAttribute('data-theme', newTheme);
                    this.addLine(`Theme switched to ${newTheme}.`, "white margin", 0);
                    return;
                }

                if (command === "blog" || !command) {
                    if (!args) {
                        if (Object.keys(blogPosts).length === 0) {
                            this.addLine('Error: No posts available.', 'error margin', 0);
                        }
                        const postList = [
                            '<span class="white">Blog Posts:</span>',
                            '<span class="white">--------------------------------</span>',
                            `<span class="index">ID${' '.repeat(idPad - 2)}</span><span class="command">Title${' '.repeat(titlePad - 5)}</span>`
                        ];
                        Object.keys(blogPosts).forEach((slug, index) => {
                            const post = blogPosts[slug];
                            const id = (index + 1).toString().padEnd(idPad);
                            const title = post.title.substring(0, titlePad - 1).padEnd(titlePad);
                            postList.push(`<span class="index">${id}</span><span class="command">${title}</span>`);
                        });
                        this.loopLines(postList, "white margin", 80);
                    } else if (args === '--help') {
                        const blogHelp = [
                            '<span class="white">Blog Command Options:</span>',
                            '<span class="white">------------------</span>',
                            `<span class="command">blog${' '.repeat(helpCmdPad - 4)}</span><span class="white">-List all blog posts.</span>`,
                            `<span class="command">blog [title]${' '.repeat(helpCmdPad -12)}</span><span class="white">-View a specific post by title.</span>`,
                            `<span class="command">blog --help${' '.repeat(helpCmdPad - 11)}</span><span class="white">-Show this help message.</span>`,
                            `<span class="command">blog --slug${' '.repeat(helpCmdPad - 11)}</span><span class="white">-List posts with their slug identifiers.</span>`
                        ];
                        this.loopLines(blogHelp, "white margin", 80);
                    } else if (args === '--slug') {
                        const postList = [
                            '<span class="white">Blog Posts with Slugs:</span>',
                            '<span class="white">--------------------------------</span>',
                            `<span class="index">ID${' '.repeat(idPad - 2)}</span><span class="command">Slug${' '.repeat(slugPad - 4)}</span><span class="white">Title</span>`
                        ];
                        Object.keys(blogPosts).forEach((slug, index) => {
                            const post = blogPosts[slug];
                            const id = (index + 1).toString().padEnd(idPad);
                            const slugText = slug.substring(0, slugPad - 1).padEnd(slugPad);
                            const title = post.title.substring(0, 30);
                            postList.push(`<span class="index">${id}</span><span class="command">${slugText}</span><span class="white">${title}</span>`);
                        });
                        this.loopLines(postList, "white margin", 80);
                    } else {
                        let foundSlug = null;
                        const inputTitle = args.trim();
                        const inputSlug = inputTitle.toLowerCase().replace(/\s+/g, '-');

                        for (const slug in blogPosts) {
                            if (slug === inputSlug || blogPosts[slug].title.toLowerCase() === inputTitle.toLowerCase()) {
                                foundSlug = slug;
                                break;
                            }
                        }

                        if (foundSlug) {
                            const post = blogPosts[foundSlug];
                            if (post.url) {
                                try {
                                    const response = await fetch(post.url, { cache: 'no-store' });
                                    if (!response.ok) {
                                        throw new Error(`HTTP error! Status: ${response.status}`);
                                    }
                                    const markdownContent = await response.text();
                                    const markdown = marked.parse(markdownContent);
                                    const sanitized = DOMPurify.sanitize(markdown);
                                    this.addLine(`<div class="markdown-content">${sanitized}</div>`, "white margin", 0);
                                } catch (error) {
                                    this.addLine(`Error fetching post '${post.title}': ${error.message}`, "error margin", 0);
                                }
                            } else {
                                const markdown = marked.parse(post.content);
                                const sanitized = DOMPurify.sanitize(markdown);
                                this.addLine(`<div class="markdown-content">${sanitized}</div>`, "white margin", 0);
                            }
                        } else {
                            this.addLine(`Post '${args}' not found. Type <span class="command">blog</span> to list posts.`, "error margin", 0);
                        }
                    }
                } else {
                    let foundTitleSlug = null;
                    const inputTitle = cmd.trim();
                    const inputSlug = inputTitle.toLowerCase().replace(/\s+/g, '-');

                    for (const slug in blogPosts) {
                        if (slug === inputSlug || blogPosts[slug].title.toLowerCase() === inputTitle.toLowerCase()) {
                            foundTitleSlug = slug;
                            break;
                        }
                    }

                    if (foundTitleSlug) {
                        const post = blogPosts[foundTitleSlug];
                        if (post.url) {
                            try {
                                const response = await fetch(post.url, { cache: 'no-store' });
                                if (!response.ok) {
                                    throw new Error(`HTTP error! Status: ${response.status}`);
                                }
                                const markdownContent = await response.text();
                                const markdown = marked.parse(markdownContent);
                                const sanitized = DOMPurify.sanitize(markdown);
                                this.addLine(`<div class="markdown-content">${sanitized}</div>`, "white margin", 0);
                            } catch (error) {
                                this.addLine(`Error fetching post '${post.title}': ${error.message}`, "error margin", 0);
                            }
                        } else {
                            const markdown = marked.parse(post.content);
                            const sanitized = DOMPurify.sanitize(markdown);
                            this.addLine(`<div class="markdown-content">${sanitized}</div>`, "white margin", 0);
                        }
                    } else {
                        this.addLine(`Command not recognized. Type <span class="command">blog</span> to list posts or enter a post title.`, "error margin", 100);
                    }
                }
            }
        }

        async function initialize() {
            try {
                await loadBlogPosts();
                terminals.set(terminalCount, new Terminal(terminalCount++));
            } catch (error) {
                console.error('Initialization error:', error.message);
                terminals.set(terminalCount, new Terminal(terminalCount++));
                terminals.forEach(t => t.addLine(`Error: Failed to initialize terminal: ${error.message}`, 'error margin', 0));
            }
        }

        initialize();

        window.addEventListener('error', (e) => {
            console.error('Global error:', e.message);
            if (terminals.size > 0) {
                terminals.forEach(t => t.addLine(`Error: ${e.message}`, 'error margin', 0));
            }
        });

        window.addEventListener('resize', () => {
            terminals.forEach(term => {
                if (!term.isMaximized) {
                    const maxWidth = window.innerWidth - parseInt(term.element.style.left || '0') - 10;
                    const maxHeight = window.innerHeight - parseInt(term.element.style.top || '0') - 10;
                    term.element.style.width = `${Math.min(term.element.offsetWidth, maxWidth)}px`;
                    term.element.style.height = `${Math.min(term.element.offsetHeight, maxHeight)}px`;
                    term.element.style.display = 'flex';
                }
            });
        });
    </script>
</body>
</html>
